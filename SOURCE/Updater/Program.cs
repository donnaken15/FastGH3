using System;
using System.IO;
using System.Net;
using System.Text;
using Ionic.Zip;

// VS is a slow POS

class Program
{
	static byte[] logoBits = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x11, 0x11,
		0x00, 0x11, 0x11, 0x11, 0x00, 0x11, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00,
		0x00, 0x11, 0x00, 0x00, 0x00, 0x11, 0x11, 0x11, 0x00, 0x11, 0x11, 0x11,
		0x00, 0x11, 0x00, 0x10, 0x00, 0x11, 0x00, 0x10, 0x00, 0x11, 0x00, 0x11,
		0x00, 0x11, 0x00, 0x11, 0x00, 0x11, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x11, 0x00, 0x10, 0x01, 0x11, 0x00, 0x11, 0x01, 0x00, 0x10, 0x11, 0x21,
		0x00, 0x11, 0x10, 0x21, 0x10, 0x01, 0x10, 0x21, 0x11, 0x11, 0x11, 0x01,
		0x11, 0x11, 0x11, 0x01, 0x01, 0x00, 0x10, 0x01, 0x01, 0x00, 0x10, 0x21,
		0x00, 0x00, 0x10, 0x21, 0x00, 0x00, 0x10, 0x01, 0x00, 0x00, 0x10, 0x01,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x20, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
		0x22, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00,
		0x22, 0x22, 0x02, 0x00, 0x20, 0x22, 0x22, 0x00, 0x00, 0x00, 0x22, 0x02,
		0x02, 0x00, 0x20, 0x02, 0x22, 0x00, 0x22, 0x02, 0x22, 0x22, 0x22, 0x00,
		0x20, 0x22, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x02, 0x30,
		0x22, 0x22, 0x02, 0x33, 0x22, 0x00, 0x30, 0x33, 0x22, 0x00, 0x33, 0x03,
		0x22, 0x00, 0x33, 0x00, 0x22, 0x00, 0x33, 0x00, 0x22, 0x00, 0x33, 0x00,
		0x22, 0x00, 0x33, 0x00, 0x22, 0x00, 0x33, 0x03, 0x22, 0x00, 0x30, 0x33,
		0x22, 0x00, 0x00, 0x33, 0x22, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x33, 0x33, 0x00, 0x44, 0x33, 0x33, 0x03, 0x44, 0x00, 0x30, 0x33, 0x44,
		0x00, 0x00, 0x33, 0x44, 0x00, 0x00, 0x00, 0x44, 0x30, 0x33, 0x33, 0x44,
		0x30, 0x33, 0x33, 0x44, 0x00, 0x00, 0x33, 0x44, 0x00, 0x00, 0x33, 0x44,
		0x00, 0x30, 0x33, 0x44, 0x33, 0x33, 0x03, 0x44, 0x33, 0x33, 0x00, 0x44,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x55, 0x00, 0x00, 0x44, 0x55,
		0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x44, 0x00,
		0x44, 0x44, 0x44, 0x00, 0x44, 0x44, 0x44, 0x00, 0x00, 0x00, 0x44, 0x00,
		0x00, 0x00, 0x44, 0x55, 0x00, 0x00, 0x44, 0x55, 0x00, 0x00, 0x44, 0x50,
		0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0x55, 0x55, 0x00,
		0x55, 0x55, 0x55, 0x00, 0x00, 0x00, 0x55, 0x00, 0x00, 0x50, 0x55, 0x00,
		0x00, 0x55, 0x05, 0x00, 0x50, 0x55, 0x00, 0x00, 0x00, 0x50, 0x05, 0x00,
		0x00, 0x00, 0x55, 0x00, 0x00, 0x00, 0x55, 0x00, 0x05, 0x50, 0x55, 0x00,
		0x55, 0x55, 0x05, 0x00, 0x55, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

	/*
	 * 
	 * ████████   ██  ████████████  █████  ██    ██████████
	 * ████████  ███ █████████████ ███████ ██    ██████████
	 * ██       ███████      ██   ███   █████    ██      ██
	 * ██      ██ ████       ██  ███     ████    ██     ███
	 * ██     ██  █████      ██  ██        ██    ██    ███ 
	 * █████████████ █████   ██  ██   █████████████   ███  
	 * █████████████  █████  ██  ██   █████████████     ██ 
	 * ██   ██    ██     ███ ██  ██      ████    ██      ██
	 * ██   ██    ████    ██ ██  ███     ████    ████    ██
	 * ██  ██     █████  ███ ██   ███   █████    █████  ███
	 * ██  ██     ██ ██████  ██    ███████ ██    ██ ██████ 
	 * ██  ██     ██  ████   ██     █████  ██    ██  ████  
	 * 
	 */

	static uint Eswap(uint value)
	{
		return ((value & 0xFF) << 24) |
				((value & 0xFF00) << 8) |
				((value & 0xFF0000) >> 8) |
				((value & 0xFF000000) >> 24);
	}
	static uint Eswap(int value)
	{
		return Eswap((uint)value);
	}
	static ushort Eswap(ushort value)
	{
		return (ushort)((value << 8) | (value >> 8));
	}
	
	static void Main(string[] args)
	{
		Console.WriteLine();
		// i probably spent more time on this banner code and exporting to byte array than writing the actual update code
		for (int k = 2; k < 14; k++)
		{
			//string bits = "";
			Console.CursorLeft = 2;
			for (int i = 2; i < (8*7)-2; i++)
			{
				// autism
				int bit = (logoBits[(((i&7)>>1)+(k<<2)+((i>>3)<<6))] >> ((i & 1) << 2) & 7);
				char block = bit == 0 ? ' ' : '█';
				Console.ResetColor();
				switch (bit)
				{
					case 1:
						bit = 0xA;
						break;
					case 2:
						bit = 0xC;
						break;
					case 3:
						bit = 0xE;
						break;
					case 4:
						bit = 0x9;
						break;
					case 5:
						bit = 0xE;
						Console.BackgroundColor = ConsoleColor.Red;
						block = '▒';
						break;
				}
				Console.ForegroundColor = (ConsoleColor)(bit);
				Console.Write(block);
				//Console.Write(block); // double width
				// more often people will just have consolas
				// or whatever as the default font, so
				// don't bother with it here probably
				
				//bits += block;
				// can't use if i want custom colors
			}
			Console.ResetColor();
			Console.Write((char)160); //prevent red from 3 bleeding out to the right when resizing window
			Console.WriteLine();
		}
		Console.ResetColor();
		Console.WriteLine();
		Console.ForegroundColor = ConsoleColor.White;
		Console.WriteLine("  1.0\n");
		Console.ResetColor();
		Console.WriteLine("  UPDATER\n");
		
		bool testing = true;
		string dir = "";
		if (!testing)
			dir = Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location);
		else
			dir = Path.GetDirectoryName("C:\\Program Files (x86)\\FastGH3\\Updater.exe");
		Directory.SetCurrentDirectory(dir);
		
		string buildname = null;
		string vfilespath = "DATA\\MUSIC\\TOOLS\\";
		string vbin = "v.bin";
		string btbin = "bt.bin";
		if (File.Exists(vfilespath+vbin))
		{
			buildname = Encoding.UTF8.GetString(Convert.FromBase64String(File.ReadAllText(vfilespath+vbin)));
		}
		Console.WriteLine("Current build: "+buildname);
		
		Console.WriteLine("Checking latest build...");
		uint latestTimestamp = 0;
		try
		{
			using (WebClient onlineTimestamp = new WebClient())
			{
				onlineTimestamp.Proxy = null;
				onlineTimestamp.Headers.Add("user-agent", "Anything");
				ServicePointManager.SecurityProtocol = (SecurityProtocolType)(0xc0 | 0x300 | 0xc00);
				//https://raw.githubusercontent.com/donnaken15/FastGH3/main/DATA/MUSIC/TOOLS/bt.bin
				latestTimestamp = BitConverter.ToUInt32(onlineTimestamp.DownloadData("https://donnaken15.tk/bt.bin"),0);
				//Console.WriteLine(onlineTimestamp.DownloadString("https://donnaken15.tk/bt.bin"));
			}
		}
		catch (Exception ex)
		{
			Console.WriteLine("Encountered an error when checking the latest build time.");
			Console.WriteLine(ex);
			Console.ReadKey();
		}
		
		Console.WriteLine(latestTimestamp);
		Console.WriteLine(dir);
		
	}
}
